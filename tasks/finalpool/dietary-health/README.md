# Dietary-Health Task

## 任务描述

这是一个饮食健康任务，模拟男大学生需要分析当前饮食并制定健康饮食计划的场景。

## 任务目标

1. **饮食分析**: Agent需要分析当前饮食清单(`cuisine.md`)的营养搭配是否合理
2. **营养计算**: 使用营养数据表(`Nutrition.xlsx`)计算碳水化合物和蛋白质摄入量
3. **问题识别**: 指出哪些营养成分不符合要求或超出上限
4. **制定计划**: 根据营养需求制定明日饮食清单(`cuisine_tomorrow.md`)
5. **计算展示**: 提供详细的计算过程和营养摄入量

## 文件结构

```
Dietary-Health/
├── docs/
│   ├── task.md                    # 任务描述（中文）
│   ├── agent_system_prompt.md    # Agent系统提示
│   └── user_system_prompt.md     # User系统提示
├── initial_workspace/
│   ├── body.md                   # 用户身体信息
│   ├── cuisine.md                # 当前饮食清单
│   ├── health_guide.md           # 健身饮食指南
│   └── Nutrition.xlsx            # 营养数据表
├── preprocess/
│   └── main.py                   # 预处理脚本（复制必要文件）
├── evaluation/
│   ├── main.py                   # 主评估脚本
│   ├── check_log.py             # 检查对话日志
│   ├── check_local.py           # 检查营养分析和明日饮食清单
│   └── check_remote.py          # 远程检查（空实现）
├── groundtruth_workspace/        # 真值工作区（空）
└── task_config.json             # 任务配置
```

## 使用的MCP服务器

- **filesystem**: 用于文件读写操作
- **howtocook**: 用于查询菜谱和食材信息
- **excel**: 用于读取营养数据表格

## 评估标准

### 1. 对话日志检查 (check_log.py)
- ✅ **营养分析检查**: 验证是否提到了营养分析相关内容
- ✅ **碳水蛋白质分析检查**: 验证是否提到了碳水化合物和蛋白质的具体分析结论
- ✅ **明日饮食计划检查**: 验证是否提到了明日饮食计划的制定
- ✅ **计算过程检查**: 验证是否提到了计算过程和营养摄入量

**详细输出包括**:
- 找到的关键词列表
- 关键词出现的消息位置
- 每项检查的通过/失败状态
- 总体评估通过率

### 2. 本地文件检查 (check_local.py)
- ✅ **文件存在性检查**: 检查是否生成了明日饮食清单文件(`cuisine_tomorrow.md`)
- ✅ **当前饮食分析验证**: 验证Agent对当前饮食的营养分析是否正确
- ✅ **菜谱真实性验证**: 使用howtocook API验证菜谱的真实性
- ✅ **营养计算验证**: 使用excel工具读取营养数据，验证营养计算的准确性
- ✅ **分析结论验证**: 验证"碳水满足要求，蛋白质摄入过多"的分析结论

**详细输出包括**:
- 用户身体信息和营养需求
- 当前饮食清单内容
- 菜谱验证结果（成功/失败）
- 每道菜的详细营养分析
- 总营养摄入量计算
- 营养需求达成分析
- Agent分析结论验证

## 用户信息

**身体信息**:
- 身高: 176cm
- 体重: 65kg
- 性别: 男
- 目标: 减脂初期

**当前饮食清单**:
- 早餐: 西红柿炒鸡蛋
- 午餐: 荔枝肉(瘦肉选择一般的熟肉)
- 晚餐: 葱油桂鱼

**营养需求标准**（减脂初期男性）:
- 碳水化合物: 2.5-3.0g/kg体重 (162.5-195g)
- 蛋白质: 1.5g/kg体重 (97.5g)

## 技术实现

评估系统具有以下智能功能：

1. **菜名提取**: 使用正则表达式从cuisine.md文件中智能提取菜肴名称
2. **菜谱验证**: 调用howtocook API验证菜肴的真实性
3. **营养数据读取**: 使用excel工具读取Nutrition.xlsx中的营养数据
4. **营养计算**: 根据食材匹配和重量估算计算营养摄入量
5. **分析结论验证**: 验证Agent的营养分析结论是否正确
6. **详细透明输出**: 提供完整的评估过程和结果详情

## 评估输出示例

评估系统会生成详细的报告，包括：

```
🥗 DIETARY-HEALTH 任务完整评估报告
================================================================================

对话日志内容检查
================================================================================
📊 助手回复消息数量: 1

🔍 检查结果:
1️⃣ 营养分析检查: ✅ 已提及营养分析
2️⃣ 碳水蛋白质分析检查: ✅ 已提及碳水蛋白质分析
3️⃣ 明日饮食计划检查: ✅ 已提及明日饮食计划
4️⃣ 计算过程检查: ✅ 已提及计算过程

📈 总体评估: 通过项目: 4/4 🎉 所有检查项目均通过！

DIETARY-HEALTH 任务评估详细报告
================================================================================
👤 用户信息:
  身高: 176cm
  体重: 65kg
  减脂初期营养需求:
    碳水化合物: 162.5-195.0g
    蛋白质: 97.5g

🔍 当前饮食菜谱验证结果:
  • 成功找到菜谱: 2 道
  • ✅ 西红柿炒鸡蛋 - 找到有效菜谱
  • ✅ 葱油桂鱼 - 找到有效菜谱

📊 当前饮食营养分析（验证Agent分析是否正确）:
  【西红柿炒鸡蛋】:
    碳水化合物: 15.2g
    蛋白质: 18.5g
  【葱油桂鱼】:
    碳水化合物: 2.1g
    蛋白质: 25.8g

📈 当前总营养摄入:
  碳水化合物总量: 175.3g
  蛋白质总量: 126.2g

🔬 验证Agent分析结论:
  预期结论: 碳水满足要求，蛋白质摄入过多
  实际计算: 碳水满足要求，蛋白质过多
  ✅ Agent的营养分析结论正确!

最终评估结果汇总
================================================================================
✅ 对话日志检查: 通过
✅ 本地文件检查: 通过  
✅ 远程资源检查: 通过

📈 总体通过率: 3/3 (100.0%)
🎉 恭喜！所有评估项目均通过！
```

这个任务充分利用了MCP的能力，既测试了Agent的营养分析能力，也测试了其与外部工具（howtocook、excel）的集成能力。评估过程完全透明，提供详细的营养计算和分析结论验证。